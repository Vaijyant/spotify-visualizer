(this["webpackJsonpspotify-visualizer"]=this["webpackJsonpspotify-visualizer"]||[]).push([[0],{106:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),r=n(31),i=n.n(r),o=(n(48),n(107)),s="3161af22a7714180bef6dbfe9a6fec9f",u="http://localhost:3001",l=n(2);function d(){var e="https://accounts.spotify.com/authorize?client_id="+s+"&response_type=code&redirect_uri=http://localhost:3000&scope="+encodeURIComponent("streaming user-read-email user-read-private user-read-email user-library-read user-library-modify user-read-playback-state user-modify-playback-state user-read-currently-playing");return Object(l.jsx)(o.a,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"100vh"},children:Object(l.jsx)("a",{className:"btn btn-success btn-lg",href:e,children:"Login with Spotify"})})}var f=n(6),h=n(15),j=n.n(h);var b=n(108),O=n(32),v=n.n(O);function p(e){var t=e.track,n=e.chooseTrack;return Object(l.jsxs)("div",{className:"d-flex m-2 align-items-center",style:{cursor:"pointer"},onClick:function(){n(t)},children:[Object(l.jsx)("img",{src:t.albumUrl,alt:"-_-",style:{height:"64px",width:"64px"}}),Object(l.jsxs)("div",{className:"ml-3",children:[Object(l.jsx)("div",{children:t.title}),Object(l.jsx)("div",{className:"text-muted",children:t.artist})]})]})}var m=n(41);function y(e){var t=e.accessToken,n=e.trackUri,a=Object(c.useState)(!1),r=Object(f.a)(a,2),i=r[0],o=r[1];return Object(c.useEffect)((function(){return o(!0)}),[n]),t?Object(l.jsx)(m.a,{showSaveIcon:"true",token:t,callback:function(e){e.isPlaying||o(!1)},play:i,uris:n?[n]:[]}):null}var g=n.p+"static/media/never.202587c7.mp3";function x(e){var t=e.audioAnalysis,n=Object(c.useState)(),a=Object(f.a)(n,2),r=a[0],i=a[1],o=Object(c.useState)(),s=Object(f.a)(o,2),u=s[0],d=s[1],h=Object(c.useState)(),j=Object(f.a)(h,2),b=j[0],O=j[1];console.log(t);var v=function(e,t,n,c){!function a(){var r=e.frequencyBinCount,i=new Uint8Array(r),o=t.width/r;n.clearRect(0,0,t.width,t.height),e.getByteFrequencyData(i),c(t,n,0,r,undefined,o,i),requestAnimationFrame(a)}()},p=function(e,t,n,c,a,r,i){for(var o=0;o<c/2;o++){a=2.5*i[o];var s=t.createLinearGradient(0,e.height-a,0,e.height);s.addColorStop(0,"red"),s.addColorStop(.5,"orange"),s.addColorStop(1,"yellow"),t.fillStyle=s,t.fillRect(e.width/2-n,e.height-a,r,a),n+=r}for(var u=0;u<c/2;u++){a=2.5*i[u];var l=t.createLinearGradient(0,e.height-a,0,e.height);l.addColorStop(0,"red"),l.addColorStop(.5,"orange"),l.addColorStop(1,"yellow"),t.fillStyle=l,t.fillRect(n,e.height-a,r,a),n+=r}},m=Object(c.useRef)(null);return Object(c.useEffect)((function(){if(r&&u&&b){var e=m.current;e.filter="blur(100px) contrast(10)";var t=e.getContext("2d"),n=new Audio;n.src=r,n.play();var c=new AudioContext,a=c.createMediaElementSource(n),i=c.createAnalyser();a.connect(i),i.connect(c.destination),i.fftSize=2048,u(i,e,t,b)}}),[r,u,b]),Object(l.jsx)("div",{style:{backgroundColor:"black",height:"100%"},onClick:function(){i(g),d((function(){return v})),O((function(){return p}))},children:Object(l.jsx)("canvas",{ref:m,style:{backgroundColor:"black"},width:"1920px",height:"889px"})})}var k=new v.a({clientId:s});function S(e){var t=function(e){var t=Object(c.useState)(),n=Object(f.a)(t,2),a=n[0],r=n[1],i=Object(c.useState)(),o=Object(f.a)(i,2),s=o[0],l=o[1],d=Object(c.useState)(),h=Object(f.a)(d,2),b=h[0],O=h[1];return Object(c.useEffect)((function(){j.a.post(u+"/auth-token",{code:e}).then((function(e){r(e.data.accessToken),l(e.data.refreshToken),O(e.data.expiresIn),window.history.pushState({},null,"/")})).catch((function(){window.location="/"}))}),[e]),Object(c.useEffect)((function(){if(s&&b){var e=setInterval((function(){j.a.post(u+"/refresh-authtoken",{refreshToken:s}).then((function(e){r(e.data.accessToken),O(e.data.expiresIn)})).catch((function(){window.location="/"}))}),1e3*(b-60));return function(){return clearInterval(e)}}}),[s,b]),a}(e.code),n=Object(c.useState)(""),a=Object(f.a)(n,2),r=a[0],i=a[1],o=Object(c.useState)([]),s=Object(f.a)(o,2),d=s[0],h=s[1],O=Object(c.useState)(),v=Object(f.a)(O,2),m=v[0],g=v[1],S=Object(c.useState)({}),w=Object(f.a)(S,2),C=w[0],A=w[1];function T(e){g(e),i(""),A({})}return Object(c.useEffect)((function(){m&&k.getAudioAnalysisForTrack(m.id).then((function(e){A(e)}))}),[m]),Object(c.useEffect)((function(){t&&k.setAccessToken(t)}),[t]),Object(c.useEffect)((function(){if(!r)return h([]);if(t){var e=!1;return k.searchTracks(r).then((function(t){e||h(t.body.tracks.items.map((function(e){var t=e.album.images.reduce((function(e,t){return t.height<e.height?t:e}),e.album.images[0]);return{artist:e.artists[0].name,title:e.name,uri:e.uri,id:e.id,albumUrl:t.url}})))})),function(){return e=!0}}}),[r,t]),Object(l.jsxs)("div",{className:"d-flex flex-column",style:{height:"100vh"},children:[Object(l.jsx)(b.a.Control,{type:"search",placeholder:"Search Songs/Artists",value:r,onChange:function(e){return i(e.target.value)}}),Object(l.jsxs)("div",{className:"flex-grow-1",style:{overflowY:"auto"},children:[d.map((function(e){return Object(l.jsx)(p,{track:e,chooseTrack:T},e.uri)})),0===d.length&&Object(l.jsx)("div",{style:{height:"100%"},children:Object(l.jsx)(x,{audioAnalysis:C})})]}),Object(l.jsx)("div",{children:Object(l.jsx)(y,{accessToken:t,trackUri:null===m||void 0===m?void 0:m.uri})})]})}var w=new URLSearchParams(window.location.search).get("code");var C=function(){return w?Object(l.jsx)(S,{code:w}):Object(l.jsx)(d,{})};i.a.render(Object(l.jsx)(a.a.StrictMode,{children:Object(l.jsx)(C,{})}),document.getElementById("root"))},85:function(e,t){}},[[106,1,2]]]);
//# sourceMappingURL=main.aac1f48c.chunk.js.map